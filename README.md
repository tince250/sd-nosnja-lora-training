# Fine-tuning Stable Diffusion with LoRA

Applying the `LoRA method` of fine-tuning the `Stable Diffusion v1.5` as the base model, on the task of learning to generate `Serbian traditional clothing` ("narodna nosnja").

During training with different hyperparameter tunning, dataset, and label tweaks, 3 successful versions of clothing "narodna nosnja" LoRAs were chosen:
- v1
- v2
- v3

All three give satisfactory results and can generate images of girls wearing traditional Serbian clothing with high accuracy and generalization ability.

The repository contains:
- `FineTuneStableDiffusionNosnjaPoster.pdf` - research poster for the project
- `Project presentation.pdf` - presentation slides for the project 
- `Srpska_Nosnja_LoRA_SD_fine_tuning.ipynb` - notebook used for fine-tuning Stable Diffusion with LoRA, adapted from Kohyaa's scripts
- `dataset/` - folder containing images used for training
- `labels/` - folder containing labels used for training
- `lora files/` - folder containing the produced LoRA safetensors files
- `demo images/` - folder containing representative results generated by different Stable Diffusion models and produced LoRAs
- `tests/` - folder containing XYZ plots used for verification and investigation of results across different checkpoints and hyperparameter configurations

### Running inference

To try out the LoRA's, you can load them into any Stable Diffusion UI of your choice and use them with any checkpoint model, like any other LoRA (or use them in code, however you like to do your inference).

If you don't have a UI in mind, you can use the `Srpska_Nosnja_LoRA_SD_fine_tuning.ipynb` by following these steps:
- use section *2.1. Download Available Model* or *2.2.  Download Custom Model* to download SD checkpoint of your choice
- navigate to section *6.3. Inference*:
  - upload LoRA file of your choice to Colab's files
  - copy path to LoRA, and paste it into *network_weight* field
  - leave *matmul* at 0.85 or more
  - upload model to Colabr's files, copy path and paste to *model* field
  - write any *prompt* and *negative prompt*, but be sure to use the guidelines for prompting listed below
  - 30 *steps*, *cfg scale* 7, ddim *sampler*, *clip skip* 1 - for hyperparameters

Be sure to put **trigger word**: `nosnjaoutift` at the start of the prompt, and include `wearing traditional nosnjaoutfit` in the prompt as well, for best results. \
For negative prompt add: `hat, headpiece`, as the model tends to generate hats with these LoRAs.

Project for university course: "Soft computing" \
Student: Tina Mihajlovic SV3/2020
